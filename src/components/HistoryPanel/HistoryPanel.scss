@use '../../styling/globals' as *;

.history-panel {
    .history-section {
        display: flex;
        margin-bottom: $space-6;
        gap: $space-4;
        align-items: flex-start;
        //max-width: 1000px;

        .section-header {
            flex-shrink: 0;
            width: 120px;
            position: sticky;
            top: 0;
            
            .section-title {
                font-family: $font-inter;
                font-size: $font-xs;
                font-weight: $font-bold;
                color: $neutral-medium-gray;
                padding: $space-1 0;
                margin: 0;
                text-align: right;
                line-height: $leading-normal;
                text-transform: uppercase;
            }
        }


    }

  .section-entries {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: $space-1;
  }

    // Apply these styles only when viewing full history
    &.full-history {
        display: flex;
        flex-direction: column;
        height: 100%;
        max-height: calc(var(--app-vh, 1vh) * 100);
        background-color: $neutral-lightest-gray;
        box-sizing: border-box;
        min-height: 0; // Critical for nested flex scrolling

        .history-panel-header {
            padding: $space-2;
            background: $neutral-white;
            border-bottom: $border-half solid $neutral-light-gray;
            box-shadow: $container-shadow-bottom-bigger;
            flex-shrink: 0;
            z-index: 2;
            display: flex;
            flex-direction: row;
            gap: $space-6;
            width: 100%;
            align-items: flex-start;
            justify-content: flex-start;
            
            .header-controls {
                display: flex;
                flex-direction: row;
                gap: $space-6;
                flex-wrap: wrap;
            }

            .header-actions {
                margin-left: auto;
                display: flex;
                align-items: center;
            }
            
            .toggle-container {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                margin-bottom: 0;
                
                label {
                    @include form-label;
                    margin-bottom: $space-2;
                }
            }
        }

        .history-panel-content {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            min-height: 0;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            padding: $space-5;
            
            // Center the content area
            //max-width: 1200px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            
            @media (max-width: $mobile-breakpoint) {
              padding: $space-2;
            }
            
            &::-webkit-scrollbar {
                width: $space-2;
            }
            
            &::-webkit-scrollbar-track {
                background: transparent;
            }
            
            &::-webkit-scrollbar-thumb {
                background-color: rgba($neutral-dark-gray, 0.3);
                border-radius: $radius-base;
            }

            // Loading and empty state messages
            > p {
                @include body-regular;
                text-align: center;
                color: $neutral-dark-gray;
                margin: $space-8 0;
                flex-shrink: 0;
            }
        }

        .history-panel-footer {
            padding: $space-2;
            background: $neutral-white;
            border-top: $border-half solid $neutral-light-gray;
            box-shadow: $container-shadow-top-bigger;
            flex-shrink: 0;
            z-index: 2;
            width: 100%;
            
            // Center the footer content to align with content area
            display: flex;
            justify-content: center;
            
            .pagination-controls {
                max-width: 1200px;
                width: 90%;
            }

          // shadcn pagination: force link text color to our primary-medium
          .history-pagination {
              [data-slot="pagination-link"] {
                  color: $primary-medium !important;
                  &:hover {
                      color: $primary-medium !important;
                  }
                  svg {
                      color: inherit;
                  }
              }
          }
        }
    }
}

// Mobile sidebar variant tweaks
@media (max-width: $mobile-breakpoint) {
  .mobile-drawer-content .history-panel {
    .timestamp,
    .selected-card-display {
      display: none !important;
    }

    .entry-title {
      font-size: $font-sm;
    }
  }

  // Stack section header above entries on mobile for the full history page
  .history-panel {
    .history-section {
      flex-direction: column;
      gap: $space-1;
      align-items: stretch;
      margin-bottom: $space-2;

      .section-header {
        position: static;
        top: auto;
        width: 100%;

        .section-title {
          text-align: left;
          padding: 0;
          margin: 0;
        }
      }
    }

    &.full-history {
      .history-panel-content {
        padding: $space-3;
      }
    }
  }

  // Hide desktop controls and show mobile-only button in header
  .history-panel.full-history .history-panel-header {
    .desktop-only { display: none !important; }
    .mobile-only { display: inline-flex !important; }
    .header-actions { margin-left: auto; }
  }
}

// Base: hide the mobile-only button by default; mobile media query will show it
.history-panel.full-history .history-panel-header {
  .mobile-only { display: none; }
}

// Desktop and larger: enforce hiding the mobile-only button and show desktop controls
@media (min-width: ($mobile-breakpoint + 1px)) {
  .history-panel.full-history .history-panel-header {
    .mobile-only { display: none !important; }
    .desktop-only { display: inline-flex !important; }
  }
}

// Drawer layout tweaks for history filters
.drawer-header-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.drawer-body {
  padding: $space-4;
  display: flex;
  flex-direction: column;
  gap: $space-4;
}

// Increase spacing and breathing room for the history filters drawer
.mobile-history-filters-drawer {
  .dialog-body {
    padding: $space-4 $space-6;
    display: grid;
    row-gap: $space-6;

    // Normalize margins on children to rely on the grid gap
    > * {
      margin: 0;
    }
  }

  @media (max-width: $mobile-breakpoint) {
    .dialog-body {
      padding: $space-3 $space-3;
      row-gap: $space-4;
    }
  }
}

// Styling for the plain-text Reset link in the drawer header
.history-filters-header {
  position: relative;
  gap: $space-2;

  // Center title and right-align Reset using CSS grid with 3 columns
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;

  h2 {
    margin: 0;
    grid-column: 2;
    justify-self: center;
    text-align: center;
  }

  .header-actions {
    grid-column: 3;
    justify-self: end;
    display: flex;
    align-items: center;
    margin-left: 0; // no auto margin; grid handles placement

    .reset-link {
      color: $error;
      cursor: pointer;
      font-size: $font-sm;
      user-select: none;
      &:hover { opacity: 0.9; }
      &:active { opacity: 0.8; }
    }
  }
}

// Force override the default column layout from .drawer-sticky-header when combined with our header
.dialog-header.drawer-sticky-header.history-filters-header {
  display: grid !important;
  grid-template-columns: 1fr auto 1fr !important;
  align-items: center !important;
  text-align: center !important;
}

// Adjust pagination controls styling for the sticky footer
.pagination-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: $space-2;
  margin: 0;
  padding: 0;

  .pagination-numbers {
    display: flex;
    gap: $space-1;
  }

  button {
    @include button-outline;
    min-width: 36px;
    padding: $space-2 $space-3 !important;
    font-size: $font-sm;
    border-width: $border-full !important;
    box-sizing: border-box;
    
    &.pagination-number {
      &.active {
        @include button-primary;
        padding: $space-2 $space-3 !important;
        border-width: $border-full !important;
      }
    }

    &.pagination-edge-button,
    &.pagination-nav-button {
      font-weight: $font-semibold;
      padding: $space-2 $space-3 !important;
    }
    
    &:focus,
    &:active {
      padding: $space-2 $space-3 !important;
      border-width: $border-full !important;
    }
  }
}


.date-filter {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  margin-bottom: 0;

  .filter-label {
    @include form-label;
    margin-bottom: $space-2;
  }

  .filter-wrapper {
    position: relative;
    display: inline-flex;
    align-items: center;
    border: $border-full solid $neutral-gray;
    border-radius: $radius-base;
    background-color: $neutral-white;
    max-width: fit-content;
    transition: all $transition-fast;
    
    &:hover {
      border-color: $neutral-medium-gray;
    }

    select {
      appearance: none;
      border: none;
      background: transparent;
      padding: $space-2 $space-3;
      font-size: $font-sm;
      cursor: pointer;
      color: $neutral-black;
      font-family: $font-inter;
      border-radius: 0;
      margin-bottom: 0;
      
      &:focus {
        outline: none;
      }

      &::-ms-expand {
        display: none;
      }
    }

    .month-select {
      min-width: 140px;
      border-right: $border-full solid $neutral-gray;
      padding-right: $space-6;
    }

    .year-select {
      min-width: 90px;
      padding-right: $space-8;
    }

    .clear-filter {
      position: absolute;
      right: $space-2;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      padding: 0;
      width: $space-5;
      height: $space-5;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: $font-h6;
      color: $neutral-dark-gray;
      border-radius: $radius-full;
      transition: all $transition-fast;
      
      &:hover {
        background-color: $neutral-light-gray;
        color: $neutral-black;
      }

      &:focus {
        outline: none;
        box-shadow: 0 0 0 2px $accent-color;
      }
    }

    // Custom dropdown arrows
    .month-select,
    .year-select {
      position: relative;
      
      &::after {
        content: '';
        position: absolute;
        right: $space-3;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 5px solid $neutral-dark-gray;
        pointer-events: none;
      }
    }

    // When the filter has focus
    &:focus-within {
      border-color: $primary-color;
      box-shadow: 0 0 0 3px rgba($primary-color, 0.2);
    }

    // Active state styling (when filter is applied)
    &.active {
      background-color: $neutral-black;
      border-color: $neutral-black;

      select {
        color: $neutral-white;
        
        option {
          color: $neutral-black;
          background: $neutral-white;
        }
      }

      .clear-filter {
        color: $neutral-white;
        
        &:hover {
          background-color: rgba($neutral-white, 0.1);
          color: $neutral-white;
        }
      }

      .month-select::after,
      .year-select::after {
        border-top-color: $neutral-white;
      }
    }
  }
}

// Component-specific compact styling for the monthly statement filter
.date-filter.statement-filter {

  .filter-wrapper {
    gap: $space-1;
    padding: 0; // tighter

    select {
      padding: $space-1 $space-2;
      font-size: $font-xs; // smaller text
      color: $neutral-medium-gray; // default gray text
    }

    .month-select {
      min-width: 110px;
      padding-right: $space-5;
    }

    .year-select {
      min-width: 72px;
      padding-right: $space-5;
    }

    .month-select::after,
    .year-select::after {
      right: $space-2;
      border-left-width: 4px;
      border-right-width: 4px;
      border-top-width: 4px;
    }

    // Active state: white text against black background
    &.active {
      select {
        color: $neutral-white;
      }
    }

    // Remove green focus outline for this component
    &:focus-within {
      box-shadow: none;
      border-color: $neutral-gray;
    }
  }
}